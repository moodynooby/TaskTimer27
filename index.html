<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Task Timer App</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@3.1.0/dist/full.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-10px); }
    }
    .task-item {
      animation: fadeIn 0.3s ease-out;
    }
    .task-item.removing {
      animation: fadeOut 0.3s ease-out;
    }
    .timer-animation {
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .progress-ring {
      transition: stroke-dashoffset 0.35s;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }
  </style>
</head>
<body class="bg-base-200" data-theme="dark">
<div class="container mx-auto p-4 max-w-md">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold">Task Timer</h1>
    <label for="settings-modal" class="btn btn-primary">Settings</label>

  </div>

  <div class="flex justify-center mb-4 relative">
    <svg class="w-32 h-32">
      <circle class="text-base-300" stroke-width="10" stroke="currentColor" fill="transparent" r="58" cx="64" cy="64"/>
      <circle id="progressRing" class="progress-ring text-primary" stroke-width="10" stroke="currentColor" fill="transparent" r="58" cx="64" cy="64"/>
    </svg>
    <div id="timer" class="text-4xl font-bold absolute mt-12">25:00</div>
  </div>

  <div class="flex mb-4">
    <input type="text" id="taskInput" placeholder="Add a new task" class="input input-bordered w-full max-w-xs mr-2">
    <button id="addTask" class="btn btn-primary">Add Task</button>
  </div>

  <ul id="taskList" class="mb-4"></ul>

  <div class="flex justify-center space-x-2 mb-4">
    <button id="startStop" class="btn btn-success">Start</button>
    <button id="reset" class="btn btn-warning">Reset</button>
  </div>

  <div class="stats shadow w-full mb-4">
    <div class="stat">
      <div class="stat-title">Current Mode</div>
      <div id="currentMode" class="stat-value">Work</div>
    </div>
    <div class="stat">
      <div class="stat-title">Completed Cycles</div>
      <div id="cycleCount" class="stat-value">0</div>
    </div>
  </div>

  <div class="stats shadow w-full mb-4">
    <div class="stat">
      <div class="stat-title">Total Work Time</div>
      <div id="totalWorkTime" class="stat-value">00:00:00</div>
    </div>
    <div class="stat">
      <div class="stat-title">Total Break Time</div>
      <div id="totalBreakTime" class="stat-value">00:00:00</div>
    </div>
  </div>

  <div class="stats shadow w-full mb-4">
    <div class="stat">
      <div class="stat-title">Completed Tasks</div>
      <div id="completedTasks" class="stat-value">0</div>
    </div>
    <div class="stat">
      <div class="stat-title">Pending Tasks</div>
      <div id="pendingTasks" class="stat-value">0</div>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<input type="checkbox" id="settings-modal" class="modal-toggle" />
<div class="modal">
  <div class="modal-box">

    <h3 class="font-bold text-lg mb-4">Timer Settings</h3>
    <div class="form-control">
      <label class="label">
        <span class="label-text">Work Duration (minutes)</span>
      </label>
      <input type="number" id="workDuration" class="input input-bordered w-full" value="25" min="1" max="60">
    </div>
    <div class="form-control">
      <label class="label">
        <span class="label-text">Break Duration (minutes)</span>
      </label>
      <input type="number" id="breakDuration" class="input input-bordered w-full" value="5" min="1" max="30">
    </div>
    <div class="form-control">
      <label class="label">
        <span class="label-text">Long Break Duration (minutes)</span>
      </label>
      <input type="number" id="longBreakDuration" class="input input-bordered w-full" value="15" min="1" max="60">
    </div>
    <div class="form-control">
      <label class="label">
        <span class="label-text">Cycles before Long Break</span>
      </label>
      <input type="number" id="cyclesBeforeLongBreak" class="input input-bordered w-full" value="4" min="1" max="10">
    </div>
    <div class="modal-action">
      <label for="settings-modal" class="btn btn-primary" id="saveSettings">Save Settings</label>
      <label for="settings-modal" class="btn">Close</label>
    </div>
  </div>
</div>

<script>
  const taskInput = document.getElementById('taskInput');
  const addTaskBtn = document.getElementById('addTask');
  const taskList = document.getElementById('taskList');
  const timerDisplay = document.getElementById('timer');
  const startStopBtn = document.getElementById('startStop');
  const resetBtn = document.getElementById('reset');
  const currentModeDisplay = document.getElementById('currentMode');
  const cycleCountDisplay = document.getElementById('cycleCount');
  const progressRing = document.getElementById('progressRing');
  const saveSettingsBtn = document.getElementById('saveSettings');
  const totalWorkTimeDisplay = document.getElementById('totalWorkTime');
  const totalBreakTimeDisplay = document.getElementById('totalBreakTime');
  const completedTasksDisplay = document.getElementById('completedTasks');
  const pendingTasksDisplay = document.getElementById('pendingTasks');

  let tasks = [];
  let timer;
  let timeLeft = 25 * 60; // 25 minutes in seconds
  let isRunning = false;
  let isWorkMode = true;
  let cycleCount = 0;
  let totalWorkTime = 0;
  let totalBreakTime = 0;

  let settings = {
    workDuration: 25 * 60,
    breakDuration: 5 * 60,
    longBreakDuration: 15 * 60,
    cyclesBeforeLongBreak: 4
  };

  function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const remainingSeconds = seconds % 60;
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
  }

  function updateTimer() {
    timerDisplay.textContent = formatTime(timeLeft);
    const totalTime = isWorkMode ? settings.workDuration :
            (cycleCount % settings.cyclesBeforeLongBreak === 0 ? settings.longBreakDuration : settings.breakDuration);
    const progress = (totalTime - timeLeft) / totalTime;
    const circumference = 2 * Math.PI * 58;
    progressRing.style.strokeDasharray = `${circumference} ${circumference}`;
    progressRing.style.strokeDashoffset = circumference * (1 - progress);
  }

  function updateStats() {
    totalWorkTimeDisplay.textContent = formatTime(totalWorkTime);
    totalBreakTimeDisplay.textContent = formatTime(totalBreakTime);
    completedTasksDisplay.textContent = tasks.filter(task => task.completed).length;
    pendingTasksDisplay.textContent = tasks.filter(task => !task.completed).length;
  }

  function switchMode() {
    isWorkMode = !isWorkMode;
    if (isWorkMode) {
      timeLeft = settings.workDuration;
      currentModeDisplay.textContent = 'Work';
    } else {
      cycleCount++;
      if (cycleCount % settings.cyclesBeforeLongBreak === 0) {
        timeLeft = settings.longBreakDuration;
        currentModeDisplay.textContent = 'Long Break';
      } else {
        timeLeft = settings.breakDuration;
        currentModeDisplay.textContent = 'Short Break';
      }
      cycleCountDisplay.textContent = cycleCount;
    }
    startStopBtn.textContent = isRunning ? 'Stop' : 'Start';
    updateTimer();
  }

  function startStopTimer() {
    if (isRunning) {
      clearInterval(timer);
      startStopBtn.textContent = 'Start';
      startStopBtn.classList.remove('btn-error');
      startStopBtn.classList.add('btn-success');
      timerDisplay.classList.remove('timer-animation');
    } else {
      timer = setInterval(() => {
        if (timeLeft > 0) {
          timeLeft--;
          if (isWorkMode) {
            totalWorkTime++;
          } else {
            totalBreakTime++;
          }
          updateTimer();
          updateStats();
        } else {
          clearInterval(timer);
          isRunning = false;
          switchMode();
          startStopTimer();
        }
      }, 1000);
      startStopBtn.textContent = 'Stop';
      startStopBtn.classList.remove('btn-success');
      startStopBtn.classList.add('btn-error');
      timerDisplay.classList.add('timer-animation');
    }
    isRunning = !isRunning;
  }

  function resetTimer() {
    clearInterval(timer);
    isWorkMode = true;
    timeLeft = settings.workDuration;
    isRunning = false;
    cycleCount = 0;
    totalWorkTime = 0;
    totalBreakTime = 0;
    currentModeDisplay.textContent = 'Work';
    cycleCountDisplay.textContent = '0';
    startStopBtn.textContent = 'Start';
    startStopBtn.classList.remove('btn-error');
    startStopBtn.classList.add('btn-success');
    timerDisplay.classList.remove('timer-animation');
    updateTimer();
    updateStats();
  }

  function addTask() {
    const taskName = taskInput.value.trim();
    if (taskName) {
      tasks.push({ id: Date.now(), name: taskName, completed: false, description: '' });
      taskInput.value = '';
      renderTasks();
      updateStats();
    }
  }

  function toggleTask(id) {
    tasks = tasks.map(task =>
            task.id === id ? { ...task, completed: !task.completed } : task
    );
    renderTasks();
    updateStats();
  }

  function deleteTask(id) {
    const taskElement = document.getElementById(`task-${id}`);
    taskElement.classList.add('removing');
    setTimeout(() => {
      tasks = tasks.filter(task => task.id !== id);
      renderTasks();
      updateStats();
    }, 300);
  }

  function editTaskDescription(id, description) {
    tasks = tasks.map(task =>
            task.id === id ? { ...task, description } : task
    );
    renderTasks();
  }

  function renderTasks() {
    taskList.innerHTML = '';
    tasks.forEach(task => {
      const li = document.createElement('li');
      li.id = `task-${task.id}`;
      li.className = 'task-item mb-2 p-2 bg-base-100 rounded-lg shadow-sm';
      li.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <input type="checkbox" class="checkbox mr-2" ${task.completed ? 'checked' : ''}>
                            <span class="${task.completed ? 'line-through text-base-300' : ''}">${task.name}</span>
                        </div>
                        <button class="btn btn-ghost btn-xs text-error delete-task">Delete</button>
                    </div>
                    <div class="collapse">
                        <input type="checkbox" class="peer" />
                        <div class="collapse-title text-sm text-gray-500">
                            ${task.description ? 'Edit description' : 'Add description'}
                        </div>
                        <div class="collapse-content">
                            <textarea class="textarea textarea-bordered w-full task-description" placeholder="Enter task description">${task.description}</textarea>
                        </div>
                    </div>
                `;
      li.querySelector('input[type="checkbox"]').addEventListener('change', () => toggleTask(task.id));
      li.querySelector('.delete-task').addEventListener('click', () => deleteTask(task.id));
      li.querySelector('.task-description').addEventListener('blur', (e) => editTaskDescription(task.id, e.target.value));
      taskList.appendChild(li);
    });
  }

  function saveSettings() {
    settings = {
      workDuration: parseInt(document.getElementById('workDuration').value) * 60,
      breakDuration: parseInt(document.getElementById('breakDuration').value) * 60,
      longBreakDuration: parseInt(document.getElementById('longBreakDuration').value) * 60,
      cyclesBeforeLongBreak: parseInt(document.getElementById('cyclesBeforeLongBreak').value)
    };
    resetTimer();
  }

  addTaskBtn.addEventListener('click', addTask);
  startStopBtn.addEventListener('click', startStopTimer);
  resetBtn.addEventListener('click', resetTimer);
  saveSettingsBtn.addEventListener('click', saveSettings);

  updateTimer();
  updateStats();
</script>
</body>
</html>